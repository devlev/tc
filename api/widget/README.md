# API для получения данных из виджета
Все запросы к API нужно формировать на домен https://api.tolstoycomments.com
## Экспорт комментариев в свою базу данных
Для получения списка комментариев нужно сделать GET запрос:

`/api/export/[API_KEY]/site/[SITE_ID]/comment` - вернет 100 последних комментариев с сайта.

Для получения следующих 100 комментариев нужно подставить значение из поля comment_last_id в новый запрос к API:

`/api/export/[API_KEY]/site/[SITE_ID]/comment/[COMMENT_LAST_ID]` - вернет 100 последних комментариев с сайта которые были написаны раньше комментария COMMENT_LAST_ID

Выполняя запросы к API циклично можно получить все комментарии написаные за все время на вашем сайте.

Структура ответа сервера:
```json5
/// json
{
	"query": {
		"site_id": 0, // переданный в заголовке ваш id сайта
		"skip": null // переданное значение параметра COMMENT_LAST_ID
	},
	"data": {
		"count": 41, // кол-во комментариев в выгрузке
		"comment_last_id": null, // id последнего комментария для выгрузки следующей страницы, если null то значит это последняя страница
		"comments": [
			{
				"id": 186, // id комментария (формат - число)
				"message": "Текст сообщения", // текст сообщения (формат - текст)
				"ip": "", // ip адрес автора комментария  (формат - текст)
				"datеtime": "2017-11-27T10:06:08+00:00", // дата написания (формат - текст)
				"rating": 1, // значение рейтинга (формат - число)
				"attaches": [], // прикрепленный материал (формат - json)
				"visible": true, // true - комментарий опубликован на сайте, false - скрыт/удален/помечен как спам (формат - bool)
				"user": {
					"id": 0, // id пользователя (формат - число)
					"nick": "help", // ник (формат - текст)
					"name": "help", // имя на сайте (формат - текст)
					"email": "help@tolstoycomments.com", // email (формат - текст)
					"phone": "", // телефон (формат - текст)
					"avatar": null // ссылка на аватар (формат - текст)
				},
				"chat": {
					"id": 0, // id чата (формат - число)
					"url": "http://tolstoycomments.com/", // ссылка на страницу чата (формат - текст)
					"title": "Tolstoy comments - современные чаты на твоем сайте" // title чата (формат - текст)
				}
			}
		]
	}
}
```
## Экспорт обсуждаемых чатов в виджете
Для получения списка самых обсжудаемых чатов нужно сделать GET запрос:
`/api/export/[API_KEY]/site/[SITE_ID]/chat` - запрос на получения списка чатов
поддерживаются следующие параметры в запросе:
`take` - колличество чатов (1,100). По умолчанию: 10
`sort` - сортировка списка чатов.
	`0` - сортировка по колличеству комментариев
	`1` - сортировка по дате создания чата
	`2` - сортировка по дате последнего комментария

Структура ответа сервера:
```json5
/// json
{
	"query": { "siteId": 0, "take": 10, "sort": 0 },
	"data": {
		"items": [
			{
				"id": 0,
				"site_id": 0,
				"title": "title",
				"url": "http://tolstoycomments.com/",
				"hash": "f235a5d0e80b79888240d027c46a7ab5",
				"count_comment": 512,
				"comment": {
					"id": 0,
					"text_template": "123123<br/>4324<br/>345<br/>4567<br/>342<br/>345<br/>345<br/>24234",
					"data_create": "2019-09-16T11:12:38+00:00",
					"user": {
						"id": 0,
						"name": "Иван Иванов",
						"nick": "ivan_ivanov",
						"ava": null,
						"online": true,
						"data_last_visit": "2019-09-25T13:46:21+00:00"
					},
					"raiting": { "id": 0, "val": 1, "user_val": 0 },
					"attaches": [],
					"attaches_text": "",
					"edited": false,
					"comment_type": 0
				}
			}
		]
	}
}
```
